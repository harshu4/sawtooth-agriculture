"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const types_1 = require("../auth/instruction-sets/common/types");
var Constants;
(function (Constants) {
    Constants[Constants["msPerLocktimeSecond"] = 1000] = "msPerLocktimeSecond";
    Constants[Constants["minimumTimestamp"] = 500000000] = "minimumTimestamp";
})(Constants || (Constants = {}));
/**
 * Convert a Javascript `Date` object to its equivalent LockTime
 * representation in an `AuthenticationVirtualMachine`.
 *
 * TODO: this method should error past the overflow Date and for dates which
 * would become BlockHeights when encoded.
 *
 * @param date the Date to convert to a BlockTime Uint8Array
 */
exports.dateToLockTime = (date) => types_1.bigIntToScriptNumber(BigInt(Math.round(date.getTime() / Constants.msPerLocktimeSecond)));
/**
 * Parse a locktime, returning a `number` for block heights, a `Date` for block
 * times, and a string for parsing errors.
 *
 * Note: this method does not check the length of locktime
 *
 * @param bin the 4-byte Uint8Array locktime to parse
 */
exports.parseLockTime = (bin) => {
    const parsed = types_1.parseBytesAsScriptNumber(bin);
    return typeof parsed === 'string'
        ? parsed
        : parsed >= BigInt(Constants.minimumTimestamp)
            ? new Date(Number(parsed) * Constants.msPerLocktimeSecond)
            : Number(parsed);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9saWIvdXRpbHMvdGltZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlFQUcrQztBQUUvQyxJQUFLLFNBR0o7QUFIRCxXQUFLLFNBQVM7SUFDWiwwRUFBMEIsQ0FBQTtJQUMxQix5RUFBNEIsQ0FBQTtBQUM5QixDQUFDLEVBSEksU0FBUyxLQUFULFNBQVMsUUFHYjtBQUVEOzs7Ozs7OztHQVFHO0FBQ1UsUUFBQSxjQUFjLEdBQUcsQ0FBQyxJQUFVLEVBQUUsRUFBRSxDQUMzQyw0QkFBb0IsQ0FDbEIsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLENBQ25FLENBQUM7QUFFSjs7Ozs7OztHQU9HO0FBQ1UsUUFBQSxhQUFhLEdBQUcsQ0FBQyxHQUFlLEVBQUUsRUFBRTtJQUMvQyxNQUFNLE1BQU0sR0FBRyxnQ0FBd0IsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUM3QyxPQUFPLE9BQU8sTUFBTSxLQUFLLFFBQVE7UUFDL0IsQ0FBQyxDQUFDLE1BQU07UUFDUixDQUFDLENBQUMsTUFBTSxJQUFJLE1BQU0sQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQUM7WUFDOUMsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxTQUFTLENBQUMsbUJBQW1CLENBQUM7WUFDMUQsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUNyQixDQUFDLENBQUMifQ==