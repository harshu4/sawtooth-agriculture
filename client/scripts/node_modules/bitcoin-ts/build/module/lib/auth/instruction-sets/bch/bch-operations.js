import { flattenBinArray } from '../../../utils/hex';
import { combineOperations, pushToStack, useOneScriptNumber, useOneStackItem, useThreeStackItems, useTwoScriptNumbers, useTwoStackItems } from '../common/combinators';
import { ConsensusCommon } from '../common/common';
import { isValidPublicKeyEncoding, isValidSignatureEncodingDER } from '../common/encoding';
import { applyError, AuthenticationErrorCommon } from '../common/errors';
import { opVerify } from '../common/flow-control';
import { bigIntToScriptNumber, booleanToScriptNumber } from '../common/types';
import { AuthenticationErrorBCH } from './bch-errors';
import { OpcodesBCH } from './bch-opcodes';
import { ConsensusBCH } from './bch-types';
export const opCat = () => (state) => useTwoStackItems(state, (nextState, a, b) => a.length + b.length > ConsensusCommon.maximumStackItemLength
    ? applyError(AuthenticationErrorBCH.exceededMaximumStackItemLength, nextState)
    : pushToStack(nextState, flattenBinArray([a, b])));
export const opSplit = (flags) => (state) => useOneScriptNumber(state, (nextState, value) => {
    const index = Number(value);
    return useOneStackItem(nextState, (finalState, item) => index < 0 || index > item.length
        ? applyError(AuthenticationErrorBCH.invalidSplitIndex, finalState)
        : pushToStack(finalState, item.slice(0, index), item.slice(index)));
}, flags.requireMinimalEncoding);
var Constants;
(function (Constants) {
    Constants[Constants["positiveSign"] = 0] = "positiveSign";
    Constants[Constants["negativeSign"] = 128] = "negativeSign";
})(Constants || (Constants = {}));
export const padMinimallyEncodedScriptNumber = (scriptNumber, length) => {
    // eslint-disable-next-line functional/no-let
    let signBit = Constants.positiveSign;
    // eslint-disable-next-line functional/no-conditional-statement
    if (scriptNumber.length > 0) {
        // eslint-disable-next-line functional/no-expression-statement, no-bitwise
        signBit = scriptNumber[scriptNumber.length - 1] & Constants.negativeSign;
        // eslint-disable-next-line functional/no-expression-statement, no-bitwise, functional/immutable-data
        scriptNumber[scriptNumber.length - 1] &= Constants.negativeSign - 1;
    }
    const result = Array.from(scriptNumber);
    // eslint-disable-next-line functional/no-loop-statement
    while (result.length < length - 1) {
        // eslint-disable-next-line functional/no-expression-statement, functional/immutable-data
        result.push(0);
    }
    // eslint-disable-next-line functional/no-expression-statement, functional/immutable-data
    result.push(signBit);
    return Uint8Array.from(result);
};
export const opNum2Bin = () => (state) => useOneScriptNumber(state, (nextState, value) => {
    const targetLength = Number(value);
    return targetLength > ConsensusCommon.maximumStackItemLength
        ? applyError(AuthenticationErrorBCH.exceededMaximumStackItemLength, nextState)
        : useOneScriptNumber(nextState, (finalState, target) => {
            const minimallyEncoded = bigIntToScriptNumber(target);
            return minimallyEncoded.length > targetLength
                ? applyError(AuthenticationErrorBCH.insufficientLength, finalState)
                : minimallyEncoded.length === targetLength
                    ? pushToStack(finalState, minimallyEncoded)
                    : pushToStack(finalState, padMinimallyEncodedScriptNumber(minimallyEncoded, targetLength));
        }, false, ConsensusCommon.maximumStackItemLength);
}, true);
export const opBin2Num = () => (state) => useOneScriptNumber(state, (nextState, target) => {
    const minimallyEncoded = bigIntToScriptNumber(target);
    return minimallyEncoded.length > ConsensusCommon.maximumScriptNumberLength
        ? applyError(AuthenticationErrorBCH.exceededMaximumScriptNumberLength, nextState)
        : pushToStack(nextState, minimallyEncoded);
}, false, ConsensusCommon.maximumStackItemLength);
export const bitwiseOperation = (combine) => (state) => useTwoStackItems(state, (nextState, a, b) => a.length === b.length
    ? pushToStack(nextState, combine(a, b))
    : applyError(AuthenticationErrorBCH.mismatchedBitwiseOperandLength, nextState));
export const opAnd = () => bitwiseOperation((a, b) => a.map((v, i) => v & b[i]));
export const opOr = () => bitwiseOperation((a, b) => a.map((v, i) => v | b[i]));
export const opXor = () => bitwiseOperation((a, b) => a.map((v, i) => v ^ b[i]));
export const opDiv = (flags) => (state) => useTwoScriptNumbers(state, (nextState, a, b) => b === BigInt(0)
    ? applyError(AuthenticationErrorBCH.divisionByZero, nextState)
    : pushToStack(nextState, bigIntToScriptNumber(a / b)), flags.requireMinimalEncoding);
export const opMod = (flags) => (state) => useTwoScriptNumbers(state, (nextState, a, b) => b === BigInt(0)
    ? applyError(AuthenticationErrorBCH.divisionByZero, nextState)
    : pushToStack(nextState, bigIntToScriptNumber(a % b)), flags.requireMinimalEncoding);
/**
 * Validate the encoding of a raw signature â€“ a signature without a signing
 * serialization type byte (A.K.A. "sighash" byte).
 *
 * @param signature the raw signature
 */
export const isValidSignatureEncodingBCHRaw = (signature) => signature.length === 0 ||
    signature.length === ConsensusBCH.schnorrSignatureLength ||
    isValidSignatureEncodingDER(signature);
export const opCheckDataSig = (sha256, secp256k1) => (state) => 
// eslint-disable-next-line complexity
useThreeStackItems(state, (nextState, signature, message, publicKey) => {
    if (!isValidSignatureEncodingBCHRaw(signature)) {
        return applyError(AuthenticationErrorCommon.invalidSignatureEncoding, nextState);
    }
    if (!isValidPublicKeyEncoding(publicKey)) {
        return applyError(AuthenticationErrorCommon.invalidPublicKeyEncoding, nextState);
    }
    const digest = sha256.hash(message);
    const useSchnorr = signature.length === ConsensusBCH.schnorrSignatureLength;
    const success = useSchnorr
        ? secp256k1.verifySignatureSchnorr(signature, publicKey, digest)
        : secp256k1.verifySignatureDERLowS(signature, publicKey, digest);
    return !success && signature.length !== 0
        ? applyError(AuthenticationErrorCommon.nonNullSignatureFailure, nextState)
        : pushToStack(nextState, booleanToScriptNumber(success));
});
export const opCheckDataSigVerify = (sha256, secp256k1) => combineOperations(opCheckDataSig(sha256, secp256k1), opVerify());
export const bitcoinCashOperations = (sha256, secp256k1, flags) => ({
    [OpcodesBCH.OP_CAT]: opCat(),
    [OpcodesBCH.OP_SPLIT]: opSplit(flags),
    [OpcodesBCH.OP_NUM2BIN]: opNum2Bin(),
    [OpcodesBCH.OP_BIN2NUM]: opBin2Num(),
    [OpcodesBCH.OP_AND]: opAnd(),
    [OpcodesBCH.OP_OR]: opOr(),
    [OpcodesBCH.OP_XOR]: opXor(),
    [OpcodesBCH.OP_DIV]: opDiv(flags),
    [OpcodesBCH.OP_MOD]: opMod(flags),
    [OpcodesBCH.OP_CHECKDATASIG]: opCheckDataSig(sha256, secp256k1),
    [OpcodesBCH.OP_CHECKDATASIGVERIFY]: opCheckDataSigVerify(sha256, secp256k1)
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmNoLW9wZXJhdGlvbnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvbGliL2F1dGgvaW5zdHJ1Y3Rpb24tc2V0cy9iY2gvYmNoLW9wZXJhdGlvbnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBTXJELE9BQU8sRUFDTCxpQkFBaUIsRUFDakIsV0FBVyxFQUNYLGtCQUFrQixFQUNsQixlQUFlLEVBQ2Ysa0JBQWtCLEVBQ2xCLG1CQUFtQixFQUNuQixnQkFBZ0IsRUFDakIsTUFBTSx1QkFBdUIsQ0FBQztBQUMvQixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbkQsT0FBTyxFQUNMLHdCQUF3QixFQUN4QiwyQkFBMkIsRUFDNUIsTUFBTSxvQkFBb0IsQ0FBQztBQUM1QixPQUFPLEVBQUUsVUFBVSxFQUFFLHlCQUF5QixFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDekUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ2xELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxxQkFBcUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRTlFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUN0RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFFM0MsTUFBTSxDQUFDLE1BQU0sS0FBSyxHQUFHLEdBRWpCLEVBQUUsQ0FBQyxDQUFDLEtBQVksRUFBRSxFQUFFLENBQ3RCLGdCQUFnQixDQUFDLEtBQUssRUFBRSxDQUFDLFNBQVMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FDMUMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsTUFBTSxHQUFHLGVBQWUsQ0FBQyxzQkFB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