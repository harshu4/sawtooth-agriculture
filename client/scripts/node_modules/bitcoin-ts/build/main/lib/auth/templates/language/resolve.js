"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const utils_1 = require("../../../utils/utils");
const instruction_sets_1 = require("../../instruction-sets/instruction-sets");
const compile_1 = require("./compile");
const pluckRange = (node) => ({
    endColumn: node.end.column,
    endLineNumber: node.end.line,
    startColumn: node.start.column,
    startLineNumber: node.start.line
});
var IdentifierResolutionType;
(function (IdentifierResolutionType) {
    IdentifierResolutionType["opcode"] = "opcode";
    IdentifierResolutionType["variable"] = "variable";
    IdentifierResolutionType["script"] = "script";
})(IdentifierResolutionType = exports.IdentifierResolutionType || (exports.IdentifierResolutionType = {}));
var Constants;
(function (Constants) {
    Constants[Constants["hexByte"] = 2] = "hexByte";
})(Constants || (Constants = {}));
exports.resolveScriptSegment = (segment, resolveIdentifiers) => {
    // eslint-disable-next-line complexity
    const resolved = segment.value.map(child => {
        const range = pluckRange(child);
        switch (child.name) {
            case 'Identifier': {
                const identifier = child.value;
                const result = resolveIdentifiers(identifier);
                const ret = result.status
                    ? Object.assign({ range, type: 'bytecode', value: result.bytecode }, (result.type === IdentifierResolutionType.opcode
                        ? {
                            opcode: identifier
                        }
                        : result.type === IdentifierResolutionType.variable
                            ? {
                                variable: identifier
                            }
                            : // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition
                                result.type === IdentifierResolutionType.script
                                    ? { script: identifier, source: result.source }
                                    : { unknown: identifier })) : {
                    range,
                    type: 'error',
                    value: result.error
                };
                return ret;
            }
            case 'Push':
                return {
                    range,
                    type: 'push',
                    value: exports.resolveScriptSegment(child.value, resolveIdentifiers)
                };
            case 'Evaluation':
                return {
                    range,
                    type: 'evaluation',
                    value: exports.resolveScriptSegment(child.value, resolveIdentifiers)
                };
            case 'BigIntLiteral':
                return {
                    literalType: 'BigIntLiteral',
                    range,
                    type: 'bytecode',
                    value: instruction_sets_1.bigIntToScriptNumber(child.value)
                };
            case 'HexLiteral':
                return child.value.length % Constants.hexByte === 0
                    ? {
                        literalType: 'HexLiteral',
                        range,
                        type: 'bytecode',
                        value: utils_1.hexToBin(child.value)
                    }
                    : {
                        range,
                        type: 'error',
                        value: `Improperly formed HexLiteral. HexLiteral must have a length divisible by 2, but this HexLiteral has a length of ${child.value.length}.`
                    };
            case 'UTF8Literal':
                return {
                    literalType: 'UTF8Literal',
                    range,
                    type: 'bytecode',
                    value: utils_1.utf8ToBin(child.value)
                };
            case 'Comment':
                return {
                    range,
                    type: 'comment',
                    value: child.value
                };
            default:
                return {
                    range,
                    type: 'error',
                    // eslint-disable-next-line @typescript-eslint/no-explicit-any
                    value: `Unrecognized segment: ${child.name}`
                };
        }
    });
    return resolved.length === 0
        ? [{ range: pluckRange(segment), type: 'comment', value: '' }]
        : resolved;
};
var Time;
(function (Time) {
    Time[Time["msPerLocktimeSecond"] = 1000] = "msPerLocktimeSecond";
})(Time || (Time = {}));
const dateToLockTime = (date) => instruction_sets_1.bigIntToScriptNumber(BigInt(Math.round(date.getTime() / Time.msPerLocktimeSecond)));
const articleAndVariableType = (variableType) => `${variableType === 'HDKey' ? 'an' : 'a'} ${variableType}`;
const attemptCompilerOperation = (identifier, operationId, variableType, environment, data) => {
    if (environment.operations !== undefined) {
        const operationsForType = environment.operations[variableType];
        if (operationsForType !== undefined) {
            // eslint-disable-next-line @typescript-eslint/no-explicit-any
            const operation = operationsForType[operationId];
            if (operation !== undefined) {
                return operation(identifier, data, environment);
            }
        }
    }
    return `Identifer "${identifier}" refers to ${articleAndVariableType(variableType)} operation "${operationId}" which is not available to this compiler.`;
};
const variableTypeToDataProperty = {
    AddressData: 'addressData',
    HDKey: 'hdKeys',
    Key: 'keys',
    WalletData: 'walletData'
};
const defaultActionByVariableType = {
    AddressData: (identifier, data, variableId) => data.addressData !== undefined &&
        data.addressData[variableId] !== undefined
        ? data.addressData[variableId]
        : `Identifier "${identifier}" refers to an AddressData, but no AddressData for "${variableId}" were provided in the compilation data.`,
    HDKey: identifier => `Identifier "${identifier}" refers to an HDKey, but does not specify an operation, e.g. "${identifier}.public_key".`,
    Key: identifier => `Identifier "${identifier}" refers to a Key, but does not specify an operation, e.g. "${identifier}.public_key".`,
    WalletData: (identifier, data, variableId) => data.walletData !== undefined &&
        data.walletData[variableId] !== undefined
        ? data.walletData[variableId]
        : `Identifier "${identifier}" refers to a WalletData, but no WalletData for "${variableId}" were provided in the compilation data.`
};
const aOrAnQuotedString = (word) => `${['a', 'e', 'i', 'o', 'u'].includes(word[0].toLowerCase()) ? 'an' : 'a'} "${word}"`;
var BuiltInVariables;
(function (BuiltInVariables) {
    BuiltInVariables["currentBlockTime"] = "current_block_time";
    BuiltInVariables["currentBlockHeight"] = "current_block_height";
    BuiltInVariables["signingSerialization"] = "signing_serialization";
})(BuiltInVariables = exports.BuiltInVariables || (exports.BuiltInVariables = {}));
/**
 * If the identifer can be successfully resolved as a variable, the result is
 * returned as a Uint8Array. If the identifier references a known variable, but
 * an error occurs in resolving it, the error is returned as a string.
 * Otherwise, the identifier is not recognized as a variable, and this method
 * simply returns `false`.
 */
// eslint-disable-next-line complexity
exports.resolveAuthenticationTemplateVariable = (identifier, environment, data) => {
    var _a;
    const splitId = identifier.split('.');
    const variableId = splitId[0]; // eslint-disable-line prefer-destructuring
    const operationId = splitId[1];
    switch (variableId) {
        case BuiltInVariables.currentBlockHeight:
            return data.currentBlockHeight === undefined
                ? 'Tried to resolve the built-in variable "current_block_height", but the "currentBlockHeight" property was not provided in the compilation data.'
                : instruction_sets_1.bigIntToScriptNumber(BigInt(data.currentBlockHeight));
        case BuiltInVariables.currentBlockTime:
            return data.currentBlockTime === undefined
                ? 'Tried to resolve the built-in variable "current_block_time", but the "currentBlockTime" property was not provided in the compilation data.'
                : dateToLockTime(data.currentBlockTime);
        case BuiltInVariables.signingSerialization:
            return operationId === undefined
                ? 'Tried to resolve an operation for the built-in variable "signing_serialization", but no operation was provided. Provide an operation like "signing_serialization.[operation]".'
                : attemptCompilerOperation(identifier, operationId, 'SigningSerialization', environment, data);
        default: {
            const selected = (_a = environment.variables) === null || _a === void 0 ? void 0 : _a[variableId];
            if (selected === undefined) {
                return false;
            }
            return data[variableTypeToDataProperty[selected.type]] === undefined
                ? `Identifier "${identifier}" is a ${selected.type}, but the compilation data does not include ${aOrAnQuotedString(variableTypeToDataProperty[selected.type])} property.`
                : operationId === undefined
                    ? defaultActionByVariableType[selected.type](identifier, data, variableId)
                    : attemptCompilerOperation(identifier, operationId, selected.type, environment, data);
        }
    }
};
/**
 * Compile an internal script identifier.
 *
 * @remarks
 * If the identifer can be successfully resolved as a script, the script is
 * compiled and returned as a CompilationResultSuccess. If an error occurs in
 * compiling it, the error is returned as a string.
 *
 * Otherwise, the identifier is not recognized as a script, and this method
 * simply returns `false`.
 *
 * @param identifier the identifier of the script to be resolved
 * @param data the provided CompilationData
 * @param environment the provided CompilationEnvironment
 * @param parentIdentifier the identifier of the script which references the
 * script being resolved (for detecting circular dependencies)
 */
// eslint-disable-next-line complexity
exports.resolveScriptIdentifier = (identifier, data, environment, parentIdentifier) => {
    if (environment.scripts[identifier] === undefined) {
        return false;
    }
    if (parentIdentifier !== undefined &&
        environment.sourceScriptIds !== undefined &&
        environment.sourceScriptIds.includes(parentIdentifier)) {
        return `A circular dependency was encountered. Script "${identifier}" relies on itself to be generated. (Parent scripts: ${environment.sourceScriptIds.join(', ')})`;
    }
    const result = compile_1.compileScript(identifier, data, Object.assign(Object.assign({}, environment), { sourceScriptIds: [
            ...(environment.sourceScriptIds === undefined
                ? []
                : environment.sourceScriptIds),
            ...(parentIdentifier === undefined ? [] : [parentIdentifier])
        ] }));
    return result.success
        ? result
        : `Compilation error in resolved script, ${identifier}: ${result.errors
            .map(({ error, range }) => `${error} [${range.startLineNumber}, ${range.startColumn}]`)
            .join(', ')}`;
};
/**
 * Return an `IdentifierResolutionFunction` for use in `resolveScriptSegment`.
 *
 * @param scriptId the `id` of the script for which the resulting
 * `IdentifierResolutionFunction` will be used.
 * @param environment a snapshot of the context around `scriptId`. See
 * `CompilationEnvironment` for details.
 * @param data the actual variable values (private keys, shared wallet data,
 * shared address data, etc.) to use in resolving variables.
 */
exports.createIdentifierResolver = (scriptId, data, environment) => 
// eslint-disable-next-line complexity
(identifier) => {
    var _a;
    const opcodeResult = (_a = environment.opcodes) === null || _a === void 0 ? void 0 : _a[identifier];
    if (opcodeResult !== undefined) {
        return {
            bytecode: opcodeResult,
            status: true,
            type: IdentifierResolutionType.opcode
        };
    }
    const variableResult = exports.resolveAuthenticationTemplateVariable(identifier, environment, data);
    if (variableResult !== false) {
        return typeof variableResult === 'string'
            ? { error: variableResult, status: false }
            : {
                bytecode: variableResult,
                status: true,
                type: IdentifierResolutionType.variable
            };
    }
    const scriptResult = exports.resolveScriptIdentifier(identifier, data, environment, scriptId);
    if (scriptResult !== false) {
        return typeof scriptResult === 'string'
            ? { error: scriptResult, status: false }
            : {
                bytecode: scriptResult.bytecode,
                source: scriptResult.resolve,
                status: true,
                type: IdentifierResolutionType.script
            };
    }
    return { error: `Unknown identifier '${identifier}'.`, status: false };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzb2x2ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9saWIvYXV0aC90ZW1wbGF0ZXMvbGFuZ3VhZ2UvcmVzb2x2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLGdEQUEyRDtBQUMzRCw4RUFBK0U7QUFLL0UsdUNBQW9FO0FBVXBFLE1BQU0sVUFBVSxHQUFHLENBQUMsSUFBZ0IsRUFBUyxFQUFFLENBQUMsQ0FBQztJQUMvQyxTQUFTLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNO0lBQzFCLGFBQWEsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUk7SUFDNUIsV0FBVyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTTtJQUM5QixlQUFlLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJO0NBQ2pDLENBQUMsQ0FBQztBQW9FSCxJQUFZLHdCQUlYO0FBSkQsV0FBWSx3QkFBd0I7SUFDbEMsNkNBQWlCLENBQUE7SUFDakIsaURBQXFCLENBQUE7SUFDckIsNkNBQWlCLENBQUE7QUFDbkIsQ0FBQyxFQUpXLHdCQUF3QixHQUF4QixnQ0FBd0IsS0FBeEIsZ0NBQXdCLFFBSW5DO0FBa0JELElBQUssU0FFSjtBQUZELFdBQUssU0FBUztJQUNaLCtDQUFXLENBQUE7QUFDYixDQUFDLEVBRkksU0FBUyxLQUFULFNBQVMsUUFFYjtBQUVZLFFBQUEsb0JBQW9CLEdBQUcsQ0FDbEMsT0FBeUIsRUFDekIsa0JBQWdELEVBQ2hDLEVBQUU7SUFDbEIsc0NBQXNDO0lBQ3RDLE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFrQixLQUFLLENBQUMsRUFBRTtRQUMxRCxNQUFNLEtBQUssR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDaEMsUUFBUSxLQUFLLENBQUMsSUFBSSxFQUFFO1lBQ2xCLEtBQUssWUFBWSxDQUFDLENBQUM7Z0JBQ2pCLE1BQU0sVUFB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